{
  "version": 3,
  "sources": ["empty-module:#app/utils/cache.server.ts", "empty-module:#app/utils/permissions.server.ts", "../../../../app/routes/admin+/cache.tsx"],
  "sourcesContent": ["module.exports = {};", "module.exports = {};", "// REMIX HMR BEGIN\nif (!window.$RefreshReg$ || !window.$RefreshSig$ || !window.$RefreshRuntime$) {\n  console.warn('remix:hmr: React Fast Refresh only works when the Remix compiler is running in development mode.');\n} else {\n  var prevRefreshReg = window.$RefreshReg$;\n  var prevRefreshSig = window.$RefreshSig$;\n  window.$RefreshReg$ = (type, id) => {\n    window.$RefreshRuntime$.register(type, \"\\\"app/routes/admin+/cache.tsx\\\"\" + id);\n  }\n  window.$RefreshSig$ = window.$RefreshRuntime$.createSignatureFunctionForTransform;\n}\nvar _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport * as __hmr__ from \"remix:hmr\";\nif (import.meta) {\n  import.meta.hot = __hmr__.createHotContext(\n  //@ts-expect-error\n  \"app/routes/admin+/cache.tsx\");\n  import.meta.hot.lastModified = \"1713997504007.55\";\n}\n// REMIX HMR END\n\nimport { invariantResponse } from \"@epic-web/invariant\";\nimport { json, redirect } from \"@remix-run/node\";\nimport { Form, Link, useFetcher, useLoaderData, useSearchParams, useSubmit } from \"@remix-run/react\";\nimport { GeneralErrorBoundary } from \"#app/components/error-boundary\";\nimport { Field } from \"#app/components/forms.tsx\";\nimport { Spacer } from \"#app/components/spacer.tsx\";\nimport { Button } from \"#app/components/ui/button.tsx\";\nimport { cache, getAllCacheKeys, lruCache, searchCacheKeys } from \"#app/utils/cache.server.ts\";\nimport { useDebounce, useDoubleCheck } from \"#app/utils/misc.tsx\";\nimport { requireUserWithRole } from \"#app/utils/permissions.server.ts\";\nexport async function loader({\n  request\n}) {\n  await requireUserWithRole(request, \"admin\");\n  const searchParams = new URL(request.url).searchParams;\n  const query = searchParams.get(\"query\");\n  if (query === \"\") {\n    searchParams.delete(\"query\");\n    return redirect(`/admin/cache?${searchParams.toString()}`);\n  }\n  const limit = Number(searchParams.get(\"limit\") ?? 100);\n  let cacheKeys;\n  if (typeof query === \"string\") {\n    cacheKeys = searchCacheKeys(query, limit);\n  } else {\n    cacheKeys = getAllCacheKeys(limit);\n  }\n  return json({\n    cacheKeys\n  });\n}\nexport async function action({\n  request\n}) {\n  await requireUserWithRole(request, \"admin\");\n  const formData = await request.formData();\n  const key = formData.get(\"cacheKey\");\n  const type = formData.get(\"type\");\n  invariantResponse(typeof key === \"string\", \"cacheKey must be a string\");\n  invariantResponse(typeof type === \"string\", \"type must be a string\");\n  switch (type) {\n    case \"sqlite\":\n      {\n        await cache.delete(key);\n        break;\n      }\n    case \"lru\":\n      {\n        lruCache.delete(key);\n        break;\n      }\n    default:\n      {\n        throw new Error(`Unknown cache type: ${type}`);\n      }\n  }\n  return json({\n    success: true\n  });\n}\nexport default function CacheAdminRoute() {\n  _s();\n  const data = useLoaderData();\n  const [searchParams] = useSearchParams();\n  const submit = useSubmit();\n  const query = searchParams.get(\"query\") ?? \"\";\n  const limit = searchParams.get(\"limit\") ?? \"100\";\n  const handleFormChange = useDebounce(form => {\n    submit(form);\n  }, 400);\n  return <div className=\"container\">\n      <h1 className=\"text-h1\">Cache Admin</h1>\n      <Spacer size=\"2xs\" />\n      <Form className=\"flex flex-col gap-4\" method=\"get\" onChange={e => handleFormChange(e.currentTarget)}>\n        <div className=\"flex-1\">\n          <div className=\"flex flex-1 gap-4\">\n            <button className=\"flex h-16 items-center justify-center\" type=\"submit\">\n              \uD83D\uDD0E\n            </button>\n            <Field className=\"flex-1\" inputProps={{\n            type: \"search\",\n            name: \"query\",\n            defaultValue: query\n          }} labelProps={{\n            children: \"Search\"\n          }} />\n            <div className=\"flex h-16 w-14 items-center text-lg font-medium text-muted-foreground\">\n              <span title=\"Total results shown\">\n                {data.cacheKeys.sqlite.length + data.cacheKeys.lru.length}\n              </span>\n            </div>\n          </div>\n        </div>\n        <div className=\"flex flex-wrap items-center gap-4\">\n          <Field inputProps={{\n          name: \"limit\",\n          defaultValue: limit,\n          type: \"number\",\n          step: \"1\",\n          min: \"1\",\n          max: \"10000\",\n          placeholder: \"results limit\"\n        }} labelProps={{\n          children: \"Limit\"\n        }} />\n        </div>\n      </Form>\n      <Spacer size=\"2xs\" />\n      <div className=\"flex flex-col gap-4\">\n        <h2 className=\"text-h2\">LRU Cache:</h2>\n        {data.cacheKeys.lru.map(key => <CacheKeyRow key={key} cacheKey={key} type=\"lru\" />)}\n      </div>\n      <Spacer size=\"3xs\" />\n      <div className=\"flex flex-col gap-4\">\n        <h2 className=\"text-h2\">SQLite Cache:</h2>\n        {data.cacheKeys.sqlite.map(key => <CacheKeyRow key={key} cacheKey={key} type=\"sqlite\" />)}\n      </div>\n    </div>;\n}\n_s(CacheAdminRoute, \"z/M+YsFfBOrSgQCYrdUVeFTlOpA=\", false, function () {\n  return [useLoaderData, useSearchParams, useSubmit, useDebounce];\n});\n_c = CacheAdminRoute;\nfunction CacheKeyRow({\n  cacheKey,\n  type\n}) {\n  _s2();\n  const fetcher = useFetcher();\n  const dc = useDoubleCheck();\n  const encodedKey = encodeURIComponent(cacheKey);\n  const valuePage = `/admin/cache/${type}/${encodedKey}`;\n  return <div className=\"flex items-center gap-2 font-mono\">\n      <fetcher.Form method=\"POST\">\n        <input name=\"cacheKey\" type=\"hidden\" value={cacheKey} />\n        <input name=\"type\" type=\"hidden\" value={type} />\n        <Button size=\"sm\" variant=\"secondary\" {...dc.getButtonProps({\n        type: \"submit\"\n      })}>\n          {fetcher.state === \"idle\" ? dc.doubleCheck ? \"You sure?\" : \"Delete\" : \"Deleting...\"}\n        </Button>\n      </fetcher.Form>\n      <Link reloadDocument to={valuePage}>\n        {cacheKey}\n      </Link>\n    </div>;\n}\n_s2(CacheKeyRow, \"tH208MjkdZi2owGp90tZwDJICNw=\", false, function () {\n  return [useFetcher, useDoubleCheck];\n});\n_c2 = CacheKeyRow;\nexport function ErrorBoundary() {\n  return <GeneralErrorBoundary statusHandlers={{\n    403: ({\n      error\n    }) =>\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n    <p>You are not allowed to do that: {error?.data.message}</p>\n  }} />;\n}\n_c3 = ErrorBoundary;\nvar _c, _c2, _c3;\n$RefreshReg$(_c, \"CacheAdminRoute\");\n$RefreshReg$(_c2, \"CacheKeyRow\");\n$RefreshReg$(_c3, \"ErrorBoundary\");\n\nwindow.$RefreshReg$ = prevRefreshReg;\nwindow.$RefreshSig$ = prevRefreshSig;"],
  "mappings": "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",
  "names": []
}
