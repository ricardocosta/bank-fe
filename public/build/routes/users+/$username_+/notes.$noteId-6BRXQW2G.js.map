{
  "version": 3,
  "sources": ["../../../../../app/routes/users+/$username_+/notes.$noteId.tsx"],
  "sourcesContent": ["// REMIX HMR BEGIN\nif (!window.$RefreshReg$ || !window.$RefreshSig$ || !window.$RefreshRuntime$) {\n  console.warn('remix:hmr: React Fast Refresh only works when the Remix compiler is running in development mode.');\n} else {\n  var prevRefreshReg = window.$RefreshReg$;\n  var prevRefreshSig = window.$RefreshSig$;\n  window.$RefreshReg$ = (type, id) => {\n    window.$RefreshRuntime$.register(type, \"\\\"app/routes/users+/$username_+/notes.$noteId.tsx\\\"\" + id);\n  }\n  window.$RefreshSig$ = window.$RefreshRuntime$.createSignatureFunctionForTransform;\n}\nvar _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport * as __hmr__ from \"remix:hmr\";\nif (import.meta) {\n  import.meta.hot = __hmr__.createHotContext(\n  //@ts-expect-error\n  \"app/routes/users+/$username_+/notes.$noteId.tsx\");\n  import.meta.hot.lastModified = \"1713998134454.548\";\n}\n// REMIX HMR END\n\nimport { getFormProps, useForm } from '@conform-to/react';\nimport { parseWithZod } from '@conform-to/zod';\nimport { invariantResponse } from \"@epic-web/invariant\";\nimport { json } from \"@remix-run/node\";\nimport { Form, Link, useActionData, useLoaderData } from \"@remix-run/react\";\nimport { formatDistanceToNow } from \"date-fns\";\nimport { z } from \"zod\";\nimport { GeneralErrorBoundary } from \"#app/components/error-boundary.tsx\";\nimport { floatingToolbarClassName } from \"#app/components/floating-toolbar.tsx\";\nimport { ErrorList } from \"#app/components/forms.tsx\";\nimport { Button } from \"#app/components/ui/button.tsx\";\nimport { Icon } from \"#app/components/ui/icon.tsx\";\nimport { StatusButton } from \"#app/components/ui/status-button.tsx\";\nimport { requireUserId } from \"#app/utils/auth.server.ts\";\nimport { prisma } from \"#app/utils/db/db.server.ts\";\nimport { getNoteImgSrc, useIsPending } from \"#app/utils/misc.tsx\";\nimport { requireUserWithPermission } from \"#app/utils/permissions.server.ts.ts\";\nimport { redirectWithToast } from \"#app/utils/toast.server.ts\";\nimport { useOptionalUser, userHasPermission } from \"#app/utils/user.ts\";\nexport async function loader({\n  params\n}) {\n  const note = await prisma.note.findUnique({\n    where: {\n      id: params.noteId\n    },\n    select: {\n      id: true,\n      title: true,\n      content: true,\n      ownerId: true,\n      updatedAt: true,\n      images: {\n        select: {\n          id: true,\n          altText: true\n        }\n      }\n    }\n  });\n  invariantResponse(note, \"Not found\", {\n    status: 404\n  });\n  const date = new Date(note.updatedAt);\n  const timeAgo = formatDistanceToNow(date);\n  return json({\n    note,\n    timeAgo\n  });\n}\nconst DeleteFormSchema = z.object({\n  intent: z.literal(\"delete-note\"),\n  noteId: z.string()\n});\nexport async function action({\n  request\n}) {\n  const userId = await requireUserId(request);\n  const formData = await request.formData();\n  const submission = parseWithZod(formData, {\n    schema: DeleteFormSchema\n  });\n  if (submission.status !== 'success') {\n    return json({\n      result: submission.reply()\n    }, {\n      status: submission.status === 'error' ? 400 : 200\n    });\n  }\n  const {\n    noteId\n  } = submission.value;\n  const note = await prisma.note.findFirst({\n    select: {\n      id: true,\n      ownerId: true,\n      owner: {\n        select: {\n          username: true\n        }\n      }\n    },\n    where: {\n      id: noteId\n    }\n  });\n  invariantResponse(note, \"Not found\", {\n    status: 404\n  });\n  const isOwner = note.ownerId === userId;\n  await requireUserWithPermission(request, isOwner ? `delete:note:own` : `delete:note:any`);\n  await prisma.note.delete({\n    where: {\n      id: note.id\n    }\n  });\n  return redirectWithToast(`/users/${note.owner.username}/notes`, {\n    type: \"success\",\n    title: \"Success\",\n    description: \"Your note has been deleted.\"\n  });\n}\nexport default function NoteRoute() {\n  _s();\n  const data = useLoaderData();\n  const user = useOptionalUser();\n  const isOwner = user?.id === data.note.ownerId;\n  const canDelete = userHasPermission(user, isOwner ? `delete:note:own` : `delete:note:any`);\n  const displayBar = canDelete || isOwner;\n  return <div className=\"absolute inset-0 flex flex-col px-10\">\n      <h2 className=\"mb-2 pt-12 text-h2 lg:mb-6\">{data.note.title}</h2>\n      <div className={`${displayBar ? \"pb-24\" : \"pb-12\"} overflow-y-auto`}>\n        <ul className=\"flex flex-wrap gap-5 py-5\">\n          {data.note.images.map(image => <li key={image.id}>\n              <a href={getNoteImgSrc(image.id)}>\n                <img alt={image.altText ?? \"\"} className=\"h-32 w-32 rounded-lg object-cover\" src={getNoteImgSrc(image.id)} />\n              </a>\n            </li>)}\n        </ul>\n        <p className=\"whitespace-break-spaces text-sm md:text-lg\">\n          {data.note.content}\n        </p>\n      </div>\n      {displayBar ? <div className={floatingToolbarClassName}>\n          <span className=\"text-sm text-foreground/90 max-[524px]:hidden\">\n            <Icon className=\"scale-125\" name=\"clock\">\n              {data.timeAgo} ago\n            </Icon>\n          </span>\n          <div className=\"grid flex-1 grid-cols-2 justify-end gap-2 min-[525px]:flex md:gap-4\">\n            {canDelete ? <DeleteNote id={data.note.id} /> : null}\n            <Button asChild className=\"min-[525px]:max-md:aspect-square min-[525px]:max-md:px-0\">\n              <Link to=\"edit\">\n                <Icon className=\"scale-125 max-md:scale-150\" name=\"pencil-1\">\n                  <span className=\"max-md:hidden\">Edit</span>\n                </Icon>\n              </Link>\n            </Button>\n          </div>\n        </div> : null}\n    </div>;\n}\n_s(NoteRoute, \"DervCVTA0wfLFPjif2ltFzo3whQ=\", false, function () {\n  return [useLoaderData, useOptionalUser];\n});\n_c = NoteRoute;\nexport function DeleteNote({\n  id\n}) {\n  _s2();\n  const actionData = useActionData();\n  const isPending = useIsPending();\n  const [form] = useForm({\n    id: \"delete-note\",\n    lastResult: actionData?.result\n  });\n  return <Form method=\"POST\" {...getFormProps(form)}>\n      <input name=\"noteId\" type=\"hidden\" value={id} />\n      <StatusButton className=\"w-full max-md:aspect-square max-md:px-0\" disabled={isPending} name=\"intent\" status={isPending ? 'pending' : form.status ?? 'idle'} type=\"submit\" value=\"delete-note\" variant=\"destructive\">\n        <Icon className=\"scale-125 max-md:scale-150\" name=\"trash\">\n          <span className=\"max-md:hidden\">Delete</span>\n        </Icon>\n      </StatusButton>\n      <ErrorList errors={form.errors} id={form.errorId} />\n    </Form>;\n}\n_s2(DeleteNote, \"G+LY8oKPtG3PTaudrP2QM73mqkI=\", false, function () {\n  return [useActionData, useIsPending, useForm];\n});\n_c2 = DeleteNote;\nexport const meta = ({\n  data,\n  params,\n  matches\n}) => {\n  const notesMatch = matches.find(m => m.id === \"routes/users+/$username_+/notes\");\n  const displayName = notesMatch?.data?.owner.name ?? params.username;\n  const noteTitle = data?.note.title ?? \"Note\";\n  const noteContentsSummary = data && data.note.content.length > 100 ? data?.note.content.slice(0, 97) + \"...\" : \"No content\";\n  return [{\n    title: `${noteTitle} | ${displayName}'s Notes | Epic Notes`\n  }, {\n    name: \"description\",\n    content: noteContentsSummary\n  }];\n};\nexport function ErrorBoundary() {\n  return <GeneralErrorBoundary statusHandlers={{\n    403: () => <p>You are not allowed to do that</p>,\n    404: ({\n      params\n    }) => <p>{`No note with the id \"${params.noteId}\" exists`}</p>\n  }} />;\n}\n_c3 = ErrorBoundary;\nvar _c, _c2, _c3;\n$RefreshReg$(_c, \"NoteRoute\");\n$RefreshReg$(_c2, \"DeleteNote\");\n$RefreshReg$(_c3, \"ErrorBoundary\");\n\nwindow.$RefreshReg$ = prevRefreshReg;\nwindow.$RefreshSig$ = prevRefreshSig;"],
  "mappings": "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",
  "names": []
}
